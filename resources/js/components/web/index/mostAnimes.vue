<template>
    <section class="most-container" v-if="animeLists.length === 0">
        <div class="most-container-inner">
            <div class="most-container-tit">
                <div class="most-content-gallery-cell">
                    <div class="most-content-title-h2"><h2>Онгоинги</h2></div>
                    <div class="most-content-animes-list-option most-content-animes-list-option-1">
                        <div class="most-content-movie">
                            <div
                                class="most-content-movie-image most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-weight"
                                style="background-color: var(--cl-23)"></div>
                            <div
                                class="most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-height skeleton-weight"
                                style="background-color: var(--cl-23)">
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div
                                class="most-content-movie-image most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-weight"
                                style="background-color: var(--cl-23)"></div>
                            <div
                                class="most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-height skeleton-weight"
                                style="background-color: var(--cl-23)">
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div
                                class="most-content-movie-image most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-weight"
                                style="background-color: var(--cl-23)"></div>
                            <div
                                class="most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-height skeleton-weight"
                                style="background-color: var(--cl-23)">
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div
                                class="most-content-movie-image most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-weight"
                                style="background-color: var(--cl-23)"></div>
                            <div
                                class="most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-height skeleton-weight"
                                style="background-color: var(--cl-23)">
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div
                                class="most-content-movie-image most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-weight"
                                style="background-color: var(--cl-23)"></div>
                            <div
                                class="most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-height skeleton-weight"
                                style="background-color: var(--cl-23)">
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div
                                class="most-content-movie-image most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-weight"
                                style="background-color: var(--cl-23)"></div>
                            <div
                                class="most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-height skeleton-weight"
                                style="background-color: var(--cl-23)">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="most-content-gallery-cell">
                    <div class="most-content-title-h2"><h2>Анонсы</h2></div>
                    <div class="most-content-animes-list-option most-content-animes-list-option-2">
                        <div class="most-content-movie">
                            <div
                                class="most-content-movie-image most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-weight"
                                style="background-color: var(--cl-23)"></div>
                            <div
                                class="most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-height skeleton-weight"
                                style="background-color: var(--cl-23)">
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div
                                class="most-content-movie-image most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-weight"
                                style="background-color: var(--cl-23)"></div>
                            <div
                                class="most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-height skeleton-weight"
                                style="background-color: var(--cl-23)">
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div
                                class="most-content-movie-image most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-weight"
                                style="background-color: var(--cl-23)"></div>
                            <div
                                class="most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-height skeleton-weight"
                                style="background-color: var(--cl-23)">
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div
                                class="most-content-movie-image most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-weight"
                                style="background-color: var(--cl-23)"></div>
                            <div
                                class="most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-height skeleton-weight"
                                style="background-color: var(--cl-23)">
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div
                                class="most-content-movie-image most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-weight"
                                style="background-color: var(--cl-23)"></div>
                            <div
                                class="most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-height skeleton-weight"
                                style="background-color: var(--cl-23)">
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div
                                class="most-content-movie-image most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-weight"
                                style="background-color: var(--cl-23)"></div>
                            <div
                                class="most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-height skeleton-weight"
                                style="background-color: var(--cl-23)">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="most-content-gallery-cell">
                    <div class="most-content-title-h2"><h2>Топ аниме</h2></div>
                    <div class="most-content-animes-list-option most-content-animes-list-option-3">
                        <div class="most-content-movie">
                            <div
                                class="most-content-movie-image most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-weight"
                                style="background-color: var(--cl-23)"></div>
                            <div
                                class="most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-height skeleton-weight"
                                style="background-color: var(--cl-23)">
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div
                                class="most-content-movie-image most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-weight"
                                style="background-color: var(--cl-23)"></div>
                            <div
                                class="most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-height skeleton-weight"
                                style="background-color: var(--cl-23)">
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div
                                class="most-content-movie-image most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-weight"
                                style="background-color: var(--cl-23)"></div>
                            <div
                                class="most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-height skeleton-weight"
                                style="background-color: var(--cl-23)">
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div
                                class="most-content-movie-image most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-weight"
                                style="background-color: var(--cl-23)"></div>
                            <div
                                class="most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-height skeleton-weight"
                                style="background-color: var(--cl-23)">
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div
                                class="most-content-movie-image most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-weight"
                                style="background-color: var(--cl-23)"></div>
                            <div
                                class="most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-height skeleton-weight"
                                style="background-color: var(--cl-23)">
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div
                                class="most-content-movie-image most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-weight"
                                style="background-color: var(--cl-23)"></div>
                            <div
                                class="most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-height skeleton-weight"
                                style="background-color: var(--cl-23)">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="most-content-gallery-cell">
                    <div class="most-content-title-h2"><h2>Завершенные</h2></div>
                    <div class="most-content-animes-list-option most-content-animes-list-option-4">
                        <div class="most-content-movie">
                            <div
                                class="most-content-movie-image most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-weight"
                                style="background-color: var(--cl-23)"></div>
                            <div
                                class="most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-height skeleton-weight"
                                style="background-color: var(--cl-23)">
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div
                                class="most-content-movie-image most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-weight"
                                style="background-color: var(--cl-23)"></div>
                            <div
                                class="most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-height skeleton-weight"
                                style="background-color: var(--cl-23)">
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div
                                class="most-content-movie-image most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-weight"
                                style="background-color: var(--cl-23)"></div>
                            <div
                                class="most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-height skeleton-weight"
                                style="background-color: var(--cl-23)">
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div
                                class="most-content-movie-image most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-weight"
                                style="background-color: var(--cl-23)"></div>
                            <div
                                class="most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-height skeleton-weight"
                                style="background-color: var(--cl-23)">
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div
                                class="most-content-movie-image most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-weight"
                                style="background-color: var(--cl-23)"></div>
                            <div
                                class="most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-height skeleton-weight"
                                style="background-color: var(--cl-23)">
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div
                                class="most-content-movie-image most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-weight"
                                style="background-color: var(--cl-23)"></div>
                            <div
                                class="most-content-movie-info skeleton-cell-slide skeleton-bg skeleton-height skeleton-weight"
                                style="background-color: var(--cl-23)">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="most-container" v-if="animeLists">
        <div class="most-container-inner">
            <div class="most-container-tit">
                <div class="most-content-gallery-cell" v-for="(animeList, index) in animeLists" :key="index">
                    <div class="most-content-title-h2">
                        <h2>{{ animeList.title }}</h2>
                    </div>
                    <div class="most-content-animes-list-option"
                         :class="'most-content-animes-list-option-' + (index + 1)">
                        <div class="most-content-movie" v-for="(anime, i) in animeList.animes" :key="i"
                             @click="goToAnime(anime.id)">
                            <div class="most-content-movie-image">
                                <img v-lazy="anime.poster.mainUrl" :alt="anime.name">
                            </div>
                            <div class="most-content-movie-info">
                                <div class="most-name">
                                    <p class="most-anime-name">{{ anime.russian }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</template>

<script>
export default {
    data() {
        return {
            animeLists: [],
        };
    },
    mounted() {
        setTimeout(() => {
            this.fetchAllData();
        }, "2000");
    },
    methods: {
        async fetchAllData() {
            try {
                const response = await fetch("https://shikimori.one/api/graphql", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        Accept: "application/json",
                    },
                    body: JSON.stringify({
                        query: `
              query {
                ongoingAnimes: animes(limit: 6, order: popularity, status: "ongoing", kind: "tv") {
                  id
                  name
                  russian
                  kind
                  score
                  poster {
                    mainUrl
                  }
                  airedOn {
                    year
                  }
                }
                anonseAnimes: animes(season: "2024", limit: 6, order: popularity, status: "anons", kind: "tv") {
                  id
                  name
                  russian
                  kind
                  score
                  poster {
                    mainUrl
                  }
                  airedOn {
                    year
                  }
                }
                topAnimes: animes(limit: 6, order: ranked, status: "released", kind: "tv") {
                  id
                  name
                  russian
                  kind
                  score
                  poster {
                    mainUrl
                  }
                  airedOn {
                    year
                  }
                }
                releasedAnimes: animes(limit: 6, order: popularity, status: "released", kind: "tv") {
                  id
                  name
                  russian
                  kind
                  score
                  poster {
                    mainUrl
                  }
                  airedOn {
                    year
                  }
                }
              }
            `,
                    }),
                });

                const data = await response.json();
                console.log("%cAll data fetched successfully", "color: greenyellow");

                this.animeLists.push({
                    title: "Онгоинги",
                    animes: data.data.ongoingAnimes,
                });

                this.animeLists.push({
                    title: "Анонсы",
                    animes: data.data.anonseAnimes,
                });

                this.animeLists.push({
                    title: "Топ аниме",
                    animes: data.data.topAnimes,
                });

                this.animeLists.push({
                    title: "Завершенные",
                    animes: data.data.releasedAnimes,
                });
            } catch (error) {
                console.warn("Request error => ", error);
                this.fetchAllData();
            }
        },
        goToAnime(animeId) {
            this.$router.push(`/anime?animeId=${animeId}`);
        },
    },
};
</script>

<style lang="scss">
.most-container {
    width: 100%;

    &-inner {
        width: 100%;
        padding: 0 10px;
    }

    & .most-container-tit {
        max-width: var(--ota-ku-max-width);
        width: 100%;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        justify-content: space-between;

        .most-content-gallery-cell {
            .most-content-title-h2 {
                color: var(--most-content-title-h2-color);
                margin-bottom: 10px;
            }
        }

        .most-content-animes-list-option {
            display: flex;
            background-color: var(--cl-16);
            width: 100%;
            gap: 10px;
            padding: 20px;
            margin-bottom: 20px;
            justify-content: space-between;
            border-radius: 10px;
            flex-wrap: wrap;


            .most-content-movie {
                max-width: 180px;
                cursor: pointer;
                width: calc((100% - 10px) / 2);

                &:hover {
                    .most-content-movie-image img {
                        transform: scale(1.07);
                    }
                }

                .most-content-movie-image {
                    width: 100%;
                    border-radius: 10px;
                    overflow: hidden;
                    position: relative;
                    aspect-ratio: 1 / 1.44;
                    margin-bottom: 5px;

                    img {
                        position: absolute;
                        width: 100%;
                        height: 100%;
                        object-fit: cover;
                        transition: transform 0.2s ease-in-out;
                    }
                }

                .most-content-movie-info {
                    width: 100%;

                    .most-name {
                        display: -webkit-box;
                        -webkit-line-clamp: 1;
                        -webkit-box-orient: vertical;
                        overflow: hidden;
                        width: 100%;

                        .most-anime-name {
                            color: var(--cl-2);
                            font-size: 0.9em;
                        }
                    }
                }
            }
        }
    }

    @media screen and (max-width: 1189px) {
        .most-content-animes-list-option {
            .most-content-movie:nth-child(6) {
                display: none;
            }
        }
    }

    @media screen and (max-width: 999px) {
        .most-content-animes-list-option {
            .most-content-movie:nth-child(6),
            .most-content-movie:nth-child(5) {
                display: none;
            }
        }
    }

    @media screen and (max-width: 809px) {
        .most-content-animes-list-option {
            .most-content-movie:nth-child(6),
            .most-content-movie:nth-child(5) {
                display: block;
            }
        }
    }
}

</style>
