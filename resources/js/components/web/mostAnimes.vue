<template>
    <section class="most-container">
        <div class="most-container-inner">
            <div class="most-container-tit">
                <div class="most-content-gallery-cell">
                    <div class="most-content-title-h2">
                        <h2>Онгоинги</h2>
                    </div>
                    <div class="most-content-animes-list-option-1">
                        <div class="most-content-movie">
                            <div class="most-content-movie-image"></div>
                            <div class="most-content-movie-info">
                                <div class="most-name"></div>
                                <div class="most-status">
                                    <div class="most-type"></div>
                                    <div class="rating"></div>
                                </div>
                                <div class="most-data"></div>
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div class="most-content-movie-image"></div>
                            <div class="most-content-movie-info">
                                <div class="most-name"></div>
                                <div class="most-status">
                                    <div class="most-type"></div>
                                    <div class="rating"></div>
                                </div>
                                <div class="most-data"></div>
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div class="most-content-movie-image"></div>
                            <div class="most-content-movie-info">
                                <div class="most-name"></div>
                                <div class="most-status">
                                    <div class="most-type"></div>
                                    <div class="rating"></div>
                                </div>
                                <div class="most-data"></div>
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div class="most-content-movie-image"></div>
                            <div class="most-content-movie-info">
                                <div class="most-name"></div>
                                <div class="most-status">
                                    <div class="most-type"></div>
                                    <div class="rating"></div>
                                </div>
                                <div class="most-data"></div>
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div class="most-content-movie-image"></div>
                            <div class="most-content-movie-info">
                                <div class="most-name"></div>
                                <div class="most-status">
                                    <div class="most-type"></div>
                                    <div class="rating"></div>
                                </div>
                                <div class="most-data"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="most-content-gallery-cell">
                    <div class="most-content-title-h2">
                        <h2>Анонсы</h2>
                    </div>
                    <div class="most-content-animes-list-option-2">
                        <div class="most-content-movie">
                            <div class="most-content-movie-image"></div>
                            <div class="most-content-movie-info">
                                <div class="most-name"></div>
                                <div class="most-status">
                                    <div class="most-type"></div>
                                    <div class="rating"></div>
                                </div>
                                <div class="most-data"></div>
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div class="most-content-movie-image"></div>
                            <div class="most-content-movie-info">
                                <div class="most-name"></div>
                                <div class="most-status">
                                    <div class="most-type"></div>
                                    <div class="rating"></div>
                                </div>
                                <div class="most-data"></div>
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div class="most-content-movie-image"></div>
                            <div class="most-content-movie-info">
                                <div class="most-name"></div>
                                <div class="most-status">
                                    <div class="most-type"></div>
                                    <div class="rating"></div>
                                </div>
                                <div class="most-data"></div>
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div class="most-content-movie-image"></div>
                            <div class="most-content-movie-info">
                                <div class="most-name"></div>
                                <div class="most-status">
                                    <div class="most-type"></div>
                                    <div class="rating"></div>
                                </div>
                                <div class="most-data"></div>
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div class="most-content-movie-image"></div>
                            <div class="most-content-movie-info">
                                <div class="most-name"></div>
                                <div class="most-status">
                                    <div class="most-type"></div>
                                    <div class="rating"></div>
                                </div>
                                <div class="most-data"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="most-content-gallery-cell">
                    <div class="most-content-title-h2">
                        <h2>Топ аниме</h2>
                    </div>
                    <div class="most-content-animes-list-option-3">
                        <div class="most-content-movie">
                            <div class="most-content-movie-image"></div>
                            <div class="most-content-movie-info">
                                <div class="most-name"></div>
                                <div class="most-status">
                                    <div class="most-type"></div>
                                    <div class="rating"></div>
                                </div>
                                <div class="most-data"></div>
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div class="most-content-movie-image"></div>
                            <div class="most-content-movie-info">
                                <div class="most-name"></div>
                                <div class="most-status">
                                    <div class="most-type"></div>
                                    <div class="rating"></div>
                                </div>
                                <div class="most-data"></div>
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div class="most-content-movie-image"></div>
                            <div class="most-content-movie-info">
                                <div class="most-name"></div>
                                <div class="most-status">
                                    <div class="most-type"></div>
                                    <div class="rating"></div>
                                </div>
                                <div class="most-data"></div>
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div class="most-content-movie-image"></div>
                            <div class="most-content-movie-info">
                                <div class="most-name"></div>
                                <div class="most-status">
                                    <div class="most-type"></div>
                                    <div class="rating"></div>
                                </div>
                                <div class="most-data"></div>
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div class="most-content-movie-image"></div>
                            <div class="most-content-movie-info">
                                <div class="most-name"></div>
                                <div class="most-status">
                                    <div class="most-type"></div>
                                    <div class="rating"></div>
                                </div>
                                <div class="most-data"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="most-content-gallery-cell">
                    <div class="most-content-title-h2">
                        <h2>Завершенные</h2>
                    </div>
                    <div class="most-content-animes-list-option-4">
                        <div class="most-content-movie">
                            <div class="most-content-movie-image"></div>
                            <div class="most-content-movie-info">
                                <div class="most-name"></div>
                                <div class="most-status">
                                    <div class="most-type"></div>
                                    <div class="rating"></div>
                                </div>
                                <div class="most-data"></div>
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div class="most-content-movie-image"></div>
                            <div class="most-content-movie-info">
                                <div class="most-name"></div>
                                <div class="most-status">
                                    <div class="most-type"></div>
                                    <div class="rating"></div>
                                </div>
                                <div class="most-data"></div>
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div class="most-content-movie-image"></div>
                            <div class="most-content-movie-info">
                                <div class="most-name"></div>
                                <div class="most-status">
                                    <div class="most-type"></div>
                                    <div class="rating"></div>
                                </div>
                                <div class="most-data"></div>
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div class="most-content-movie-image"></div>
                            <div class="most-content-movie-info">
                                <div class="most-name"></div>
                                <div class="most-status">
                                    <div class="most-type"></div>
                                    <div class="rating"></div>
                                </div>
                                <div class="most-data"></div>
                            </div>
                        </div>
                        <div class="most-content-movie">
                            <div class="most-content-movie-image"></div>
                            <div class="most-content-movie-info">
                                <div class="most-name"></div>
                                <div class="most-status">
                                    <div class="most-type"></div>
                                    <div class="rating"></div>
                                </div>
                                <div class="most-data"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</template>
<script>
export default {
    data() {
        return {};
    },
    mounted() {
        this.fetchAllData();
    },
    methods: {
        async fetchAllData() {
            try {
                const response = await fetch("https://shikimori.one/api/graphql", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        Accept: "application/json",
                    },
                    body: JSON.stringify({
                        query: `
              query {
                ongoingAnimes: animes(limit: 5, order: popularity, status: "ongoing", kind: "tv") {
                  id
                  name
                  russian
                  kind
                  score
                  poster {
                    mini2xUrl
                  }
                  airedOn {
                    year
                  }
                }
                anonseAnimes: animes(season: "2024", limit: 5, order: popularity, status: "anons", kind: "tv") {
                  id
                  name
                  russian
                  kind
                  score
                  poster {
                    mini2xUrl
                  }
                  airedOn {
                    year
                  }
                }
                topAnimes: animes(limit: 5, order: ranked, status: "released", kind: "tv") {
                  id
                  name
                  russian
                  kind
                  score
                  poster {
                    mini2xUrl
                  }
                  airedOn {
                    year
                  }
                }
                releasedAnimes: animes(limit: 5, order: popularity, status: "released", kind: "tv") {
                  id
                  name
                  russian
                  kind
                  score
                  poster {
                    mini2xUrl
                  }
                  airedOn {
                    year
                  }
                }
              }
            `,
                    }),
                });

                const data = await response.json();
                console.log("%cAll data fetched successfully", "color: greenyellow");
                const ongoingAnimes = data.data.ongoingAnimes;
                const anonseAnimes = data.data.anonseAnimes;
                const topAnimes = data.data.topAnimes;
                const releasedAnimes = data.data.releasedAnimes;

                this.displayAnimeListMost(ongoingAnimes, ".most-content-animes-list-option-1");
                this.displayAnimeListMost(anonseAnimes, ".most-content-animes-list-option-2");
                this.displayAnimeListMost(topAnimes, ".most-content-animes-list-option-3");
                this.displayAnimeListMost(releasedAnimes, ".most-content-animes-list-option-4");
            } catch (error) {
                console.warn("Request error => ", error);
                this.fetchAllData(); // Retry if there's an error
            }
        },

        displayAnimeListMost(animeList, selector) {
            let mainContent = document.querySelector(selector);
            let movie = mainContent.querySelectorAll('.most-content-movie');

            animeList.forEach((anime, index) => {
                let currentCell = movie[index];
                currentCell.innerHTML = '';
                let animeHTML = `
          <div class="most-content-movie-image">
            <img src="${anime.poster.mini2xUrl}" alt="${anime.name}">
          </div>
          <div class="most-content-movie-info">
            <div class="most-name" style="background: transparent !important;">
              <router-link :to="/anime?animeId=${anime.id}">${anime.russian}</router-link>
            </div>
            <div class="most-status" style="background: transparent !important;">
              <div class="most-type">${anime.kind}</div>
              <div class="rating">
                ${anime.score}
                <i class="fa-solid fa-star" aria-hidden="true" style="cursor: pointer;"></i>
              </div>
            </div>
            <div class="most-data" style="background: transparent !important;"><p>${anime.airedOn.year}</p></div>
          </div>
        `;
                currentCell.insertAdjacentHTML("beforeend", animeHTML);
                currentCell.onclick = () => {
                    this.$router.push(`/anime?animeId=${anime.id}`);
                };
            });
        },
    }
}
</script>

<style lang="scss">
.most-container {
    width: 100%;
}

.most-container-inner {
    width: 100%;
    padding: 0 10px;
}

.most-container .most-container-tit {
    max-width: 1500px;
    width: 100%;
    margin: 0 auto;
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
}

.most-container-tit .most-content-gallery-cell {
    width: calc(25% - 10px);
}

.most-content-gallery-cell .most-content-title-h2 {
    /*margin-bottom: 10px;*/
    color: var(--most-content-title-h2-color);
}

.most-content-movie {
    width: 100%;
    padding: 10px 0;
    display: flex;
    flex-direction: row;
    border-bottom: 1px solid var(--most-content-movie-border-bottom);
    cursor: pointer;
}

.most-content-movie:hover .most-name {
    color: var(--most-content-movie-name-hover);
}

.most-content-movie .most-content-movie-image {
    background: var(--most-content-movie-content-image-background-gradient);
    aspect-ratio: 1 / 1.4;
    position: relative;
    border-radius: 4px;
    width: 20%;
    overflow: hidden;
}

.most-content-movie-image img {
    position: absolute;
    width: 100%;
    height: 100%;
    left: 0;
    pointer-events: none;
    /*object-fit: cover;*/
}

.most-content-movie-info {
    width: 80%;
    padding-left: 15px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: flex-start;
}

.most-content-movie-info .most-name {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    width: 100%;
    transition: color 0.2s ease-in-out;
    border-radius: 5px;
    height: 17px !important;
    background: var(--most-content-movie-most-name-background-gradient);
    text-align: left;
    margin-bottom: 3px;
    font-size: 0.9em;
}

.most-content-movie-info .most-name p {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.most-content-movie-info .most-status {
    display: flex;
    min-width: 50%;
    height: 17px !important;
    border-radius: 5px;
    background: var(--most-content-movie-most-status-background-gradient);
    font-size: 0.8em;
    color: var(--most-content-movie-status-text-color);
    align-items: center;
    justify-content: flex-start;
    gap: 5px;
    margin-bottom: 3px;
}

.most-content-movie-info .most-status i {
    color: var(--most-content-movie-status-star-color);
}


.most-content-movie-info .most-data {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    min-width: 50%;
    border-radius: 5px;
    height: 18px !important;
    background: var(--most-content-movie-most-data-background-gradient);
    text-align: left;
    font-size: 0.7em;
}

@media screen and (max-width: 1024px) {
    .most-container-tit .most-content-gallery-cell {
        width: calc(33.33% - 20px);
    }

    .most-container-tit .most-content-gallery-cell:nth-child(4) {
        display: none;
    }
}

@media screen and (max-width: 768px) {
    .most-container-tit .most-content-gallery-cell {
        width: calc(50% - 20px);
    }

    .most-container-tit {
        gap: 20px;
    }

    .most-container-tit .most-content-gallery-cell:nth-child(4) {
        display: unset;
    }

    .most-content-gallery-cell .most-content-title-h2 {
        text-align: center;
        font-size: 1.2em !important;
    }
}

@media screen and (max-width: 425px) {
    .most-container-tit .most-content-gallery-cell {
        width: calc(100%);
    }

}
</style>
